<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invertebrata Kaltara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            /* Prevent horizontal scroll issues due to fixed elements on mobile */
            overflow-x: hidden;
        }

        /* Base Sidebar and Header/Main Content Container */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            overflow: hidden;
            /* Prevent body scroll when fixed elements are used */
        }

        /* Sidebar styles */
        .sidebar-wrapper {
            width: 250px;
            /* Fixed width for the sidebar */
            flex-shrink: 0;
            /* Prevent shrinking */
            position: fixed;
            /* Make it fixed to the viewport */
            top: 0;
            left: 0;
            height: 100vh;
            /* Full viewport height */
            background-color: #15803D;
            /* Jawel Green - Updated color */
            color: white;
            padding: 1.5rem 1rem;
            /* Adjusted padding */
            overflow-y: auto;
            /* Enable scrolling if sidebar content overflows */
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 50;
            /* Ensure it's above main content on desktop */

            /* Transitions for mobile sidebar */
            transition: transform 0.4s ease-in-out;
            transform: translateX(0);
            /* Default position on desktop */
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            height: 100%;
            /* Fill the wrapper's height */
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding: 0.5rem 0;
            /* Adjusted padding */
            /* Removed space-x-2 from parent as it's often handled by child elements' margins */
        }

        .sidebar-header img {
            height: 50px;
            width: 50px;
            margin-right: 0.75rem;
            /* Space between logo and text */
        }

        .sidebar-header span {
            font-size: 1.25rem;
            /* Slightly larger for prominence */
            font-weight: 700;
            /* Bold */
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav li {
            margin-bottom: 0.0625rem;
            /* Reduced margin-bottom for tighter spacing (1px) */
        }

        .sidebar nav li .nav-item {
            display: flex;
            align-items: center;
            color: rgba(255, 255, 255, 0.8);
            /* Lighter white for links */
            padding: 0.3rem 1rem;
            /* Reduced vertical padding */
            border-radius: 0.375rem;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
        }

        .sidebar nav li .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            /* Slight overlay on hover */
            color: white;
        }

        .sidebar nav li .nav-item.active {
            background-color: #106F30;
            /* Darker green for active classification */
            color: white;
        }

        .sidebar nav li .nav-item i {
            margin-right: 1rem;
            width: 1.25rem;
            text-align: center;
        }

        .sidebar-create-account {
            margin-top: auto;
            /* Pushes button to the bottom */
            padding-top: 1rem;
            /* Space above button */
        }

        .sidebar-create-account button {
            background-color: #A855F7;
            /* Tailwind purple-500 equivalent */
            color: white;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .sidebar-create-account button:hover {
            background-color: #9333EA;
            /* Darker purple on hover */
        }

        /* Main content area (Header + Body Content) */
        .main-content-area-wrapper {
            flex-grow: 1;
            /* Takes all remaining width */
            margin-left: 250px;
            /* Offset by sidebar width */
            display: flex;
            flex-direction: column;
            height: 100vh;
            /* Ensure it takes full height */
            overflow-y: auto;
            /* Enable scrolling for the whole main area */
        }

        /* Header styles */
        header {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            /* Prevent header from shrinking */
        }

        header .hamburger-icon {
            font-size: 1.5rem;
            color: #4A5568;
            /* Tailwind gray-700 equivalent */
            cursor: pointer;
            display: none;
            /* Hidden by default on desktop */
            margin-right: 1rem;
            /* Space for mobile hamburger */
        }

        header .search-container {
            flex-grow: 1;
            max-width: 400px;
            /* Limit search bar width */
            position: relative;
            margin-right: 1.5rem;
            /* Space before user actions */
        }

        header .search-input {
            width: 100%;
            padding: 0.6rem 1rem;
            padding-left: 2.5rem;
            /* Space for icon */
            border: 1px solid #E2E8F0;
            /* Tailwind gray-200 */
            border-radius: 0.375rem;
            background-color: #F8FAFC;
            /* Tailwind gray-50 */
            font-size: 0.9rem;
            color: #2D3748;
            /* Tailwind gray-800 */
        }

        header .search-input::placeholder {
            color: #A0AEC0;
            /* Tailwind gray-400 */
        }

        header .search-input:focus {
            outline: none;
            border-color: #4299E1;
            /* Tailwind blue-500 */
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.5);
        }

        header .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #A0AEC0;
            /* Tailwind gray-400 */
        }

        header .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            /* Space between icons */
        }

        header .user-actions>button,
        header .user-actions>a {
            color: #4A5568;
            /* Tailwind gray-700 */
            cursor: pointer;
            font-size: 1.25rem;
            /* Icon size */
            transition: color 0.2s;
        }

        header .user-actions>button:hover,
        header .user-actions>a:hover {
            color: #2D3748;
            /* Darker on hover */
        }

        header .user-actions .notification-badge {
            position: absolute;
            top: -0.25rem;
            right: -0.25rem;
            background-color: #EF4444;
            /* Tailwind red-500 */
            color: white;
            font-size: 0.6rem;
            padding: 0.1rem 0.3rem;
            border-radius: 9999px;
        }

        header .user-actions .profile-avatar {
            width: 36px;
            height: 36px;
            border-radius: 9999px;
            background-color: #CBD5E0;
            /* Tailwind gray-300 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: #4A5568;
            overflow: hidden;
            /* Ensure image fits */
        }

        header .user-actions .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }


        /* Main content area below the header */
        main.main-content-body {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            /* Layout properties */

            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* Visual properties */
        }

        .main-content-area {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        /* Breadcrumbs container */
        .breadcrumbs-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }

        /* Species Grid Container */
        .species-grid-container {
            overflow-y: auto;
            /* Enable scrolling if content is very long */
            padding-right: 0.5rem;
            /* For scrollbar visibility */
            /* flex-grow: 1; /* Allow grid to fill space, but main-content-body already has flex-grow */
        }

        /* Species Card Styles */
        .species-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #E2E8F0;
            /* Added border for clarity */
            display: flex;
            flex-direction: column;
            /* Reverted to column for vertical layout */
            align-items: center;
            padding: 1rem;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .species-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .species-card img {
            width: 100%;
            height: 120px;
            /* Fixed height for images */
            object-fit: cover;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .species-card .species-info {
            /* Removed flex properties from here */
            display: block;
            /* Reverted to block display */
            width: 100%;
            /* Ensure it takes full width */
        }

        .species-card .species-info p:first-of-type {
            font-weight: 600;
            color: #2D3748;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .species-card .species-info p:last-of-type {
            font-size: 0.875rem;
            color: #718096;
            font-style: italic;
        }

        /* Pagination Button Styles */
        .pagination-btn {
            background-color: #E2E8F0;
            /* Tailwind gray-200 */
            color: #4A5568;
            /* Tailwind gray-700 */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            font-weight: 500;
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: #CBD5E0;
            /* Tailwind gray-300 */
        }

        .pagination-btn.active {
            background-color: #F97A00;
            /* Updated to F97A00 for active page */
            color: white;
        }


        .pagination-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }


        /* New Label Styles */
        .new-label {
            background-color: #F97A00;
            /* Your custom orange */
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.1rem 0.4rem;
            border-radius: 0.3rem;
            margin-left: 0.5rem;
            /* Ensures space to the left of the label */
            vertical-align: middle;
            display: inline-block;
            /* Ensure it respects vertical-align and margin */
        }


        /* --- MOBILE SPECIFIC STYLES --- */
        @media (max-width: 767px) {

            /* Adjust sidebar for off-canvas effect */
            .sidebar-wrapper {
                transform: translateX(-100%);
                /* Start completely off-screen */
                box-shadow: 3px 0 10px rgba(0, 0, 0, 0.3);
                /* More prominent shadow when open */
            }

            .sidebar-wrapper.open {
                transform: translateX(0);
                /* Slide in */
            }

            /* Header on mobile */
            header {
                position: fixed;
                /* Fixed header on mobile */
                width: 100%;
                /* Full width */
                left: 0;
                top: 0;
                padding: 0.75rem 1rem;
                justify-content: flex-start;
                /* Align hamburger to start */
                gap: 0.5rem;
                /* Space between hamburger and search */
                z-index: 60;
                /* Above main content, below sidebar */
            }

            header .hamburger-icon {
                display: block;
                /* Show hamburger on mobile */
            }

            header .search-container {
                margin-right: 0.5rem;
                /* Less margin on mobile */
                max-width: none;
                /* Allow search to take more width */
            }

            header .user-actions {
                gap: 0.5rem;
                /* Smaller gap on mobile */
            }

            header .user-actions>button,
            header .user-actions>a {
                font-size: 1rem;
                /* Smaller icons */
            }

            header .user-actions .profile-avatar {
                width: 30px;
                /* Smaller avatar */
                height: 30px;
            }


            /* Main content area wrapper on mobile */
            .main-content-area-wrapper {
                margin-left: 0;
                /* No offset on mobile, handled by fixed header */
                padding-top: 4rem;
                /* Offset for fixed header height */
                height: auto;
                /* Allow content to dictate height, but overflow-y auto still applies */
            }

            /* Overlay for when sidebar is open */
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 40;
                /* Below sidebar, above main content */
                display: none;
                opacity: 0;
                transition: opacity 0.4s ease-in-out;
            }

            .overlay.active {
                display: block;
                opacity: 1;
            }

            /* Prevent scrolling of body when sidebar is open */
            body.sidebar-open {
                overflow: hidden;
            }

            /* Dim and disable main content when sidebar is open */
            body.sidebar-open .main-content-area-wrapper {
                pointer-events: none;
                filter: blur(2px) grayscale(50%);
                transition: filter 0.4s ease-in-out;
            }

            body.sidebar-open header {
                /* Also dim header */
                pointer-events: none;
                filter: blur(2px) grayscale(50%);
                transition: filter 0.4s ease-in-out;
            }

            /* Sidebar close button inside sidebar (visible only on mobile) */
            .sidebar-close-btn {
                position: absolute;
                top: 1.5rem;
                right: 1.5rem;
                font-size: 1.8rem;
                color: white;
                cursor: pointer;
                z-index: 60;
                /* Above sidebar content */
                display: block;
                /* Show on mobile */
            }

            /* Card grid on mobile */
            #species-grid {
                grid-template-columns: repeat(2, 1fr);
                /* Force 2 columns on mobile */
                gap: 1rem;
            }

            .species-card {
                flex-direction: column;
                /* Keep vertical on mobile */
                padding: 1rem;
            }

            .species-card img {
                width: 100%;
                height: 100px;
                /* Smaller image height for cards */
                margin-right: 0;
                /* Remove margin-right */
            }

            .species-card .species-info p:first-of-type {
                font-size: 0.9rem;
            }

            .species-card .species-info p:last-of-type {
                font-size: 0.75rem;
            }
        }

        /* --- DESKTOP SPECIFIC STYLES (Revert mobile-only styles) --- */
        @media (min-width: 768px) {
            .sidebar-wrapper {
                transform: translateX(0);
                /* Ensure it's visible on desktop */
            }

            .hamburger-icon {
                display: none;
                /* Hide hamburger on desktop */
            }

            header {
                position: static;
                /* Not fixed on desktop */
                width: auto;
                /* Width determined by flex-grow of parent */
                left: auto;
                top: auto;
                z-index: auto;
                padding: 1rem 1.5rem;
                /* Restore desktop padding */
            }

            .main-content-area-wrapper {
                margin-left: 250px;
                /* Maintain desktop offset */
                padding-top: 0;
                /* No offset needed for header */
            }

            .overlay {
                display: none !important;
                /* Ensure overlay is always hidden on desktop */
            }

            body.sidebar-open {
                overflow: auto;
                /* Allow scrolling on desktop */
            }

            body.sidebar-open .main-content-area-wrapper,
            body.sidebar-open header {
                pointer-events: auto;
                filter: none;
            }

            .sidebar-close-btn {
                display: none;
                /* Hide close button on desktop */
            }

            #species-grid {
                grid-template-columns: repeat(3, 1fr);
                /* Default 3 columns for desktop, adjust as needed */
                gap: 1.5rem;
            }

            /* Override general card padding if specific to desktop */
            .species-card {
                padding: 1rem;
            }

            .species-card img {
                width: 100%;
                height: 120px;
                /* Restore desktop image height */
            }
        }

        /* Desktop larger screens, like lg:grid-cols-5 */
        @media (min-width: 1024px) {
            #species-grid {
                grid-template-columns: repeat(5, 1fr);
                /* Reverted to 5 columns on large screens */
            }
        }

        /* Active navigation item styling */
        #taxonomy-nav .nav-item.active {
            background-color: #106F30;
            /* Darker green for active classification */
            color: white;
        }

        /* Border on taxonomy sub-levels */
        #taxonomy-nav ul.space-y-1.ml-4.border-l {
            border-color: rgba(255, 255, 255, 0.3);
            /* Lighter border for sub-levels */
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="sidebar-wrapper" id="sidebarWrapper">
            <i class="fas fa-times sidebar-close-btn md:hidden" id="sidebarCloseBtn"></i>

            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="images/logo.png" alt="Invertebrata Kaltara Logo">
                    <span>Invertebrata Kaltara</span>
                </div>

                <nav id="taxonomy-nav" class="flex-grow">
                </nav>
            </aside>
        </div>

        <div class="main-content-area-wrapper">
            <header>
                <i class="fas fa-bars hamburger-icon md:hidden" id="hamburgerMenu"></i>

                <div class="search-container">
                    <input type="text" placeholder="Cari spesies..." class="search-input" id="searchInput">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="user-actions">
                    <a href="#" class="profile-avatar">
                        <img src="images/profil.jpg" alt="DA">
                    </a>
                </div>
            </header>

            <main class="main-content-body flex-1">
                <div class="main-content-area">

                    <div class="p-4 breadcrumbs-container">
                        <span id="breadcrumbs" class="text-gray-600">Semua Invertebrata</span>
                    </div>

                    <div class="species-grid-container overflow-y-auto pr-2 flex-grow ">
                        <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4" id="species-grid">
                        </div>
                    </div>

                    <div class="flex justify-center items-center space-x-2 mt-6" id="pagination-controls">
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="overlay" id="sidebarOverlay"></div>

    <script>
        // --- DATA ---
        const taxonomyData = {
            "Semua Invertebrata": {
                "Protozoa": [
                    "Amoebozoa",
                    "SAR (Stramenopiles, Alveolata, Rhizaria)",
                    "Excavata",
                    "Opisthokonta (terkait hewan dan jamur)"
                ],
                "Cnidaria": ["Hydrozoa", "Scyphozoa", "Cubozoa", "Anthozoa"],
                "Ctenophora": ["Tentaculata"],
                "Echinodermata": ["Asteroidea", "Ophiuroidea", "Echinoidea", "Holothuroidea", "Crinoidea"],
                "Plathyhelminthes": ["Turbellaria", "Trematoda", "Cestoda", "Monogenea"],
                "Nematoda": ["Secernentea"],
                "Rotifera": ["Bdelloidea"],
                "Nematomorpha": ["Gordioida"],
                "Gastrotricha": ["Chaetonotida"],
                "Kinorhyncha": ["Cyclorhagida"],
                "Annelida": ["Polychaeta", "Oligochaeta", "Hirudinea"],
                "Mollusca": ["Gastropoda", "Bivalvia", "Cephalopoda", "Polyplacophora", "Scaphopoda", "Monoplacophora", "Aplacophora"],
                "Arthropoda": {
                    "Chelicerata": ["Arachnida", "Merostomata", "Pycnogonida", "Xiphosura"],
                    "Myriapoda": ["Chilopoda", "Diplopoda", "Pauropoda", "Symphyla"],
                    "Crustacea": ["Malacostraca", "Maxillopoda", "Remipedia", "Branchiopoda"],
                    "Hexapoda": ["Collembola", "Protura", "Diplura", "Insecta"]
                }
            }
        };

        const speciesData = [
            { id: 1, name: "Amoeba", scientificName: "Amoeba proteus", imageUrl: "images/Amoeba.jpg", filum: "Protozoa", category: "Amoebozoa" },
            { id: 2, name: "Paramecium", scientificName: "Paramecium caudatum", imageUrl: "images/Paramecium.jpg", filum: "Protozoa", category: "SAR (Stramenopiles, Alveolata, Rhizaria)" },
            { id: 3, name: "Ubur-ubur Bulan", scientificName: "Aurelia aurita", imageUrl: "images/Ubur-ubur Bulan.jpg", filum: "Cnidaria", category: "Scyphozoa" },
            { id: 4, name: "Anemon Laut", scientificName: "Actiniaria", imageUrl: "images/Anemon Laut.jpg", filum: "Cnidaria", category: "Anthozoa" },
            { id: 5, name: "Karang Otak", scientificName: "Favia spp.", imageUrl: "images/Karang Otak.jpg", filum: "Cnidaria", category: "Anthozoa" },
            { id: 6, name: "Bintang Laut Biru", scientificName: "Linckia laevigata", imageUrl: "images/Bintang Laut Biru.jpg", filum: "Echinodermata", category: "Asteroidea" },
            { id: 7, name: "Landak Laut Hitam", scientificName: "Diadema setosum", imageUrl: "images/Landak Laut Hitam.jpg", filum: "Echinodermata", category: "Echinoidea" },
            { id: 8, name: "Teripang Pasir", scientificName: "Holothuria scabra", imageUrl: "images/Teripang Pasir.jpg", filum: "Echinodermata", category: "Holothuroidea" },
            { id: 9, name: "Bulu Babi", scientificName: "Echinothrix diadema", imageUrl: "images/Bulu Babi.jpg", filum: "Echinodermata", category: "Echinoidea" },
            { id: 10, name: "Cacing Tanah", scientificName: "Lumbricus terrestris", imageUrl: "images/Cacing Tanah.jpg", filum: "Annelida", category: "Oligochaeta" },
            { id: 11, name: "Lintah", scientificName: "Hirudinea", imageUrl: "images/Lintah.jpg", filum: "Annelida", category: "Hirudinea" },
            { id: 12, name: "Bekicot", scientificName: "Achatina fulica", imageUrl: "images/Bekicot.jpg", filum: "Mollusca", category: "Gastropoda" },
            { id: 13, name: "Siput Kebun", scientificName: "Helix aspersa", imageUrl: "images/Siput Kebun.jpg", filum: "Mollusca", category: "Gastropoda" },
            { id: 14, name: "Kerang Hijau", scientificName: "Perna viridis", imageUrl: "images/Kerang Hijau.jpg", filum: "Mollusca", category: "Bivalvia" },
            { id: 15, name: "Tiram", scientificName: "Crassostrea gigas", imageUrl: "images/Tiram.jpg", filum: "Mollusca", category: "Bivalvia" },
            { id: 16, name: "Gurita Cincin Biru", scientificName: "Hapalochlaena spp.", imageUrl: "images/Gurita Cincin Biru.jpg", filum: "Mollusca", category: "Cephalopoda" },
            { id: 17, name: "Cumi-cumi", scientificName: "Teuthida", imageUrl: "images/Cumi-cumi.jpg", filum: "Mollusca", category: "Cephalopoda" },
            { id: 18, name: "Nautilus", scientificName: "Nautilus.jpg", imageUrl: "images/Nautilus.jpg", filum: "Mollusca", category: "Cephalopoda" },
            { id: 19, name: "Laba-laba Jaring Laba-laba", scientificName: "Araneidae", imageUrl: "images/Laba-laba Jaring.jpg", filum: "Arthropoda", subFilum: "Chelicerata", category: "Arachnida" },
            { id: 20, name: "Kala Jengking", scientificName: "Scorpiones", imageUrl: "images/Kalajengking.jpg", filum: "Arthropoda", subFilum: "Chelicerata", category: "Arachnida" },
            { id: 21, name: "Lipan (Kelabang)", scientificName: "Chilopoda", imageUrl: "images/Lipan (Kelabang).jpg", filum: "Arthropoda", subFilum: "Myriapoda", category: "Chilopoda" },
            { id: 22, name: "Kaki Seribu", scientificName: "Diplopoda", imageUrl: "images/Kaki Seribu.jpg", filum: "Arthropoda", subFilum: "Myriapoda", category: "Diplopoda" },
            { id: 23, name: "Kepiting Bakau", scientificName: "Scylla serrata", imageUrl: "images/Kepiting Bakau.jpg", filum: "Arthropoda", subFilum: "Crustacea", category: "Malacostraca" },
            { id: 24, name: "Udang Windu", scientificName: "Penaeus monodon", imageUrl: "images/Udang Windu.jpg", filum: "Arthropoda", subFilum: "Crustacea", category: "Malacostraca" },
            { id: 25, name: "Kupu-kupu Morpho", scientificName: "Morpho menelaus", imageUrl: "images/Kupu-kupu Morpho.webp", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" },
            { id: 26, name: "Semut Merah", scientificName: "Solenopsis invicta", imageUrl: "images/Semut Merah.jpg", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" },
            { id: 27, name: "Capung", scientificName: "Odonata", imageUrl: "images/Capung.jpg", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" },
            { id: 28, name: "Lebah Madu", scientificName: "Apis mellifera", imageUrl: "images/Lebah Madu.jpg", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" },
            { id: 29, name: "Belalang", scientificName: "Caelifera", imageUrl: "images/Belalang.jpg", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" },
            { id: 30, name: "Lalat Rumah", scientificName: "Musca domestica", imageUrl: "images/Lalat Rumah.jpg", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" },
            { id: 31, name: "Nyamuk Aedes aegypti", scientificName: "Aedes aegypti", imageUrl: "images/Nyamuk Aedes aegypti.webp", filum: "Arthropoda", subFilum: "Hexapoda", category: "Insecta" }
        ];

        // --- DOM Elements ---
        const taxonomyNav = document.getElementById('taxonomy-nav');
        const speciesGrid = document.getElementById('species-grid');
        const paginationControls = document.getElementById('pagination-controls');
        const breadcrumbsSpan = document.getElementById('breadcrumbs');
        const searchInput = document.getElementById('searchInput');

        // --- State Variables ---
        let currentPage = 1;
        const itemsPerPage = 15;
        let currentFilterCategory = "Semua Invertebrata";
        let currentSearchQuery = "";

        // --- Mobile Menu Elements ---
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const sidebarWrapper = document.getElementById('sidebarWrapper');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const sidebarCloseBtn = document.getElementById('sidebarCloseBtn');


        // --- Functions ---

        // Mobile Sidebar Toggle Functions
        function openSidebar() {
            sidebarWrapper.classList.add('open');
            sidebarOverlay.classList.add('active');
            document.body.classList.add('sidebar-open');
        }

        function closeSidebar() {
            sidebarWrapper.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            document.body.classList.remove('sidebar-open');
        }

        /**
         * Helper function to find the full path of a category in the taxonomy data.
         * @param {object|Array|string} data - The taxonomy data object (or a part of it).
         * @param {string} targetCategory - The category to find the path for.
         * @param {Array<string>} currentPath - The current path accumulated during recursion.
         * @returns {Array<string>|null} - The full path as an array of strings, or null if not found.
         */
        function findCategoryPath(data, targetCategory, currentPath = []) {
            if (typeof data === 'string') {
                if (data === targetCategory) {
                    return [...currentPath, data];
                }
            } else if (Array.isArray(data)) {
                if (data.includes(targetCategory)) {
                    return [...currentPath, targetCategory];
                }
                for (const item of data) {
                    const foundPath = findCategoryPath(item, targetCategory, currentPath);
                    if (foundPath) return foundPath;
                }
            } else if (typeof data === 'object' && data !== null) {
                for (const key in data) {
                    const newPath = [...currentPath, key];
                    if (key === targetCategory) {
                        return newPath;
                    }
                    const foundPath = findCategoryPath(data[key], targetCategory, newPath);
                    if (foundPath) {
                        return foundPath;
                    }
                }
            }
            return null;
        }

        /**
         * Checks if a species' category belongs to the subtree of the current filter category.
         * @param {string} speciesFilum - The phylum of the species.
         * @param {string|null} speciesSubFilum - The subphylum of the species (if any).
         * @param {string} speciesCategory - The category/class of the species.
         * @param {string} currentFilterCategory - The currently selected category in the sidebar.
         * @param {object} fullTaxonomyTree - The complete taxonomy tree (e.g., taxonomyData["Semua Invertebrata"]).
         * @returns {boolean} - True if speciesCategory is a descendant or the same as currentFilterCategory, false otherwise.
         */
        function isCategoryInSubtree(speciesFilum, speciesSubFilum, speciesCategory, currentFilterCategory, fullTaxonomyTree) {
            if (currentFilterCategory === "Semua Invertebrata") {
                return true;
            }

            const filterPath = findCategoryPath(fullTaxonomyTree, currentFilterCategory, []);
            if (!filterPath) {
                return false;
            }

            let speciesPath = [];
            if (fullTaxonomyTree[speciesFilum]) {
                speciesPath.push(speciesFilum);
                let currentLevel = fullTaxonomyTree[speciesFilum];

                if (speciesFilum === "Arthropoda" && speciesSubFilum && typeof currentLevel === 'object' && !Array.isArray(currentLevel) && currentLevel[speciesSubFilum]) {
                    speciesPath.push(speciesSubFilum);
                    currentLevel = currentLevel[speciesSubFilum];
                }

                if (typeof currentLevel === 'object' && !Array.isArray(currentLevel) && currentLevel[speciesCategory]) {
                    speciesPath.push(speciesCategory);
                } else if (Array.isArray(currentLevel) && currentLevel.includes(speciesCategory)) {
                    speciesPath.push(speciesCategory);
                }
            }

            if (filterPath.length <= speciesPath.length) {
                let isPrefix = true;
                for (let i = 0; i < filterPath.length; i++) {
                    if (filterPath[i] !== speciesPath[i]) {
                        isPrefix = false;
                        break;
                    }
                }
                return isPrefix;
            }
            return false;
        }

        // Renders the taxonomy navigation in the sidebar
        function renderTaxonomy(data, parentElement, level = 0, currentPath = []) {
            const ul = document.createElement('ul');
            ul.className = `space-y-1 ${level > 0 ? 'ml-4 border-l border-green-500 pl-2' : ''}`; // Adjust border color

            Object.keys(data).sort().forEach(key => {
                const li = document.createElement('li');
                const fullPathSegment = [...currentPath, key];
                const displayKey = key.replace(/_/g, ' ');

                let fontWeightClass = 'font-normal';
                let iconClass = '';
                let contentHTML = `<span>${displayKey}</span>`;

                if (key === "Semua Invertebrata") {
                    iconClass = 'fas fa-globe';
                    fontWeightClass = 'font-bold';
                } else if (key === "Arthropoda") {
                    iconClass = 'fas fa-folder';
                    fontWeightClass = 'font-bold';
                } else if (typeof data[key] === 'object' && !Array.isArray(data[key])) {
                    iconClass = 'fas fa-folder';
                    if (level === 0) {
                        fontWeightClass = 'font-bold';
                    } else {
                        fontWeightClass = 'font-semibold';
                    }
                } else if (Array.isArray(data[key])) {
                    iconClass = 'fas fa-sitemap';
                    fontWeightClass = 'font-bold';
                } else {
                    iconClass = 'fas fa-arrow-right';
                    fontWeightClass = 'font-normal';
                }

                const navItemDiv = document.createElement('div');
                // Adjusted padding to reduce vertical spacing
                navItemDiv.className = `nav-item cursor-pointer text-sm py-1 px-3 rounded-lg ${fontWeightClass}`;
                navItemDiv.style.paddingLeft = `${0.5 + level * 1}rem`;

                // Create icon element
                const iconElement = document.createElement('i');
                iconElement.className = `${iconClass} mr-2`;
                navItemDiv.appendChild(iconElement);

                // Create text span
                const textSpan = document.createElement('span');
                textSpan.textContent = displayKey;
                navItemDiv.appendChild(textSpan);

                navItemDiv.dataset.category = key;


                navItemDiv.addEventListener('click', () => {
                    currentFilterCategory = key;
                    currentPage = 1;
                    filterAndRenderSpecies();
                    updateActiveTaxonomy(navItemDiv);
                    updateBreadcrumbs(fullPathSegment);
                    closeSidebar(); // Close sidebar on item click for mobile
                    updateSearchPlaceholder();
                });

                li.appendChild(navItemDiv);
                ul.appendChild(li);

                if (typeof data[key] === 'object' && !Array.isArray(data[key])) {
                    renderTaxonomy(data[key], li, level + 1, fullPathSegment);
                } else if (Array.isArray(data[key])) {
                    data[key].sort().forEach(subItemKey => {
                        const subLi = document.createElement('li');
                        const subItemFullPathSegment = [...fullPathSegment, subItemKey];

                        const subNavItemDiv = document.createElement('div');
                        // Adjusted padding to reduce vertical spacing
                        subNavItemDiv.className = `nav-item cursor-pointer text-xs py-0.5 px-3 rounded-lg font-normal`;
                        subNavItemDiv.style.paddingLeft = `${0.5 + (level + 1) * 1}rem`;

                        // Create icon for sub-item
                        const subIconElement = document.createElement('i');
                        subIconElement.className = `fas fa-arrow-right mr-2 text-xs`;
                        subNavItemDiv.appendChild(subIconElement);

                        // Create text span for sub-item
                        const subTextSpan = document.createElement('span');
                        subTextSpan.textContent = subItemKey.replace(/_/g, ' ');
                        subNavItemDiv.appendChild(subTextSpan);

                        // Add "NEW" label for Gastropoda as a sibling to the text span
                        if (subItemKey === "Gastropoda" && fullPathSegment.includes("Mollusca")) {
                            const newLabelSpan = document.createElement('span');
                            newLabelSpan.className = 'new-label';
                            newLabelSpan.textContent = 'NEW';
                            subNavItemDiv.appendChild(newLabelSpan);
                        }

                        subNavItemDiv.dataset.category = subItemKey;

                        subNavItemDiv.addEventListener('click', () => {
                            currentFilterCategory = subItemKey;
                            currentPage = 1;
                            filterAndRenderSpecies();
                            updateActiveTaxonomy(subNavItemDiv);
                            updateBreadcrumbs(subItemFullPathSegment);
                            closeSidebar(); // Close sidebar on item click for mobile
                            updateSearchPlaceholder();
                        });
                        subLi.appendChild(subNavItemDiv);
                        ul.appendChild(subLi);
                    });
                }
            });
            parentElement.appendChild(ul);
        }

        // Updates the active taxonomy item in the sidebar
        function updateActiveTaxonomy(activeElement) {
            const allNavItems = document.querySelectorAll('#taxonomy-nav .nav-item');
            allNavItems.forEach(item => item.classList.remove('active'));
            if (activeElement) {
                activeElement.classList.add('active');
                activeElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Renders species cards into the grid
        function renderSpeciesCards(speciesToRender) {
            speciesGrid.innerHTML = '';
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedSpecies = speciesToRender.slice(startIndex, endIndex);

            if (paginatedSpecies.length === 0) {
                speciesGrid.innerHTML = '<p class="col-span-full text-center text-gray-500 py-8">Tidak ada spesies ditemukan untuk kategori ini atau pencarian Anda.</p>';
                return;
            }

            // Apply grid classes dynamically based on screen size or use Tailwind's responsive classes
            speciesGrid.className = 'grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5'; /* Reverted grid columns */

            paginatedSpecies.forEach(species => {
                const card = document.createElement('div');
                card.className = 'species-card';
                card.dataset.id = species.id;

                card.innerHTML = `
                    <img src="${species.imageUrl}" alt="${species.name}">
                    <div class="species-info">
                        <p>${species.name}</p>
                        <p>${species.scientificName}</p>
                    </div>
                `;
                speciesGrid.appendChild(card);

                if (species.name === "Bekicot") {
                    card.classList.add('clickable');
                    card.addEventListener('click', () => {
                        window.location.href = `detailSpesiesLogin.html?id=${species.id}`;
                    });
                }
            });
        }

        // Renders pagination controls
        function renderPagination(totalItems) {
            paginationControls.innerHTML = '';
            const totalPages = Math.ceil(totalItems / itemsPerPage);

            if (totalPages <= 1) {
                return;
            }

            const prevButton = document.createElement('button');
            prevButton.className = 'pagination-btn';
            prevButton.textContent = '<';
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    filterAndRenderSpecies();
                }
            });
            paginationControls.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    filterAndRenderSpecies();
                });
                paginationControls.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.className = 'pagination-btn';
            nextButton.textContent = '>';
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    filterAndRenderSpecies();
                }
            });
            paginationControls.appendChild(nextButton);
        }

        // Filters and renders species based on current category and search query
        function filterAndRenderSpecies() {
            let filteredSpecies = speciesData.filter(species => {
                const fullTaxonomyRoot = taxonomyData["Semua Invertebrata"];
                let passesCategoryFilter = isCategoryInSubtree(species.filum, species.subFilum, species.category, currentFilterCategory, fullTaxonomyRoot);

                const matchesSearch = species.name.toLowerCase().includes(currentSearchQuery.toLowerCase()) ||
                    species.scientificName.toLowerCase().includes(currentSearchQuery.toLowerCase());

                return passesCategoryFilter && matchesSearch;
            });

            filteredSpecies.sort((a, b) => {
                const nameA = a.name.toLowerCase();
                const nameB = b.name.toLowerCase();
                if (nameA < nameB) return -1;
                if (nameA > nameB) return 1;
                return 0;
            });

            renderSpeciesCards(filteredSpecies);
            renderPagination(filteredSpecies.length);
        }

        // Updates the search input placeholder text
        function updateSearchPlaceholder() {
            let placeholderText = "Cari spesies...";
            if (currentFilterCategory && currentFilterCategory !== "Semua Invertebrata") {
                placeholderText = `Cari spesies dalam ${currentFilterCategory.replace(/_/g, ' ')}...`;
            }
            searchInput.placeholder = placeholderText;
        }

        // Updates the breadcrumbs navigation
        function updateBreadcrumbs(currentPathArray = null) {
            breadcrumbsSpan.innerHTML = '';
            let path = currentPathArray;

            if (!path) {
                const fullTaxonomyRoot = { "Semua Invertebrata": taxonomyData["Semua Invertebrata"] };
                path = findCategoryPath(fullTaxonomyRoot, currentFilterCategory, []);
                if (!path) {
                    path = ["Semua Invertebrata"];
                }
            }

            path.forEach((part, index) => {
                const displayPart = part.replace(/_/g, ' ');
                if (index > 0) {
                    const separator = document.createElement('span');
                    separator.className = 'mx-2 font-bold text-gray-400';
                    separator.textContent = '>';
                    breadcrumbsSpan.appendChild(separator);
                }

                if (index === path.length - 1) {
                    const span = document.createElement('span');
                    span.textContent = displayPart;
                    span.className = 'font-semibold text-gray-800';
                    breadcrumbsSpan.appendChild(span);
                } else {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.textContent = displayPart;
                    link.className = 'hover:underline text-gray-600 cursor-pointer';
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const newFilterPath = path.slice(0, index + 1);
                        currentFilterCategory = newFilterPath[newFilterPath.length - 1];
                        currentPage = 1;
                        filterAndRenderSpecies();
                        updateBreadcrumbs(newFilterPath);
                        updateSearchPlaceholder();
                        const navItemToActivate = document.querySelector(`#taxonomy-nav .nav-item[data-category="${currentFilterCategory}"]`);
                        updateActiveTaxonomy(navItemToActivate);
                    });
                    breadcrumbsSpan.appendChild(link);
                }
            });
        }


        // --- Event Listeners ---

        // Hamburger Menu Event Listeners
        if (hamburgerMenu) {
            hamburgerMenu.addEventListener('click', openSidebar);
        }
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', closeSidebar);
        }
        if (sidebarCloseBtn) {
            sidebarCloseBtn.addEventListener('click', closeSidebar);
        }

        // Close sidebar when a navigation item is clicked (on mobile)
        taxonomyNav.addEventListener('click', (event) => {
            if (event.target.closest('.nav-item')) {
                if (window.innerWidth < 768) {
                    closeSidebar();
                }
            }
        });

        // Close sidebar on resize if it becomes desktop view
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                closeSidebar();
            }
        });

        // Search input event listener
        searchInput.addEventListener('input', (event) => {
            currentSearchQuery = event.target.value;
            currentPage = 1;
            filterAndRenderSpecies();
        });


        // --- Initialization on DOM Load ---
        document.addEventListener('DOMContentLoaded', () => {
            taxonomyNav.innerHTML = '';
            renderTaxonomy(taxonomyData, taxonomyNav);

            const storedSearchQuery = sessionStorage.getItem('globalSearchQuery');
            if (storedSearchQuery) {
                searchInput.value = storedSearchQuery;
                currentSearchQuery = storedSearchQuery;
                sessionStorage.removeItem('globalSearchQuery');
            }

            const urlParams = new URLSearchParams(window.location.search);
            const initialCategoryFromURL = urlParams.get('category');

            if (initialCategoryFromURL) {
                currentFilterCategory = initialCategoryFromURL;
                const navItemToActivate = document.querySelector(`.nav-item[data-category="${currentFilterCategory}"]`);
                if (navItemToActivate) {
                    updateActiveTaxonomy(navItemToActivate);
                    const categoryPath = findCategoryPath(taxonomyData, currentFilterCategory, []);
                    if (categoryPath) {
                        updateBreadcrumbs(categoryPath);
                    }
                }
            } else {
                const initialActiveNav = document.querySelector(`.nav-item[data-category="${currentFilterCategory}"]`);
                if (initialActiveNav) {
                    initialActiveNav.classList.add('active');
                }
                updateBreadcrumbs([currentFilterCategory]);
            }

            filterAndRenderSpecies();
            updateSearchPlaceholder();
        });
    </script>
</body>

</html>